CREATE OR REPLACE TRIGGER TG_CHECAR_ESTOQUE
BEFORE INSERT
ON ITEMPEDIDO
FOR EACH ROW
DECLARE
    V_ESTOQUE NUMBER;
BEGIN 
    SELECT QUANTIDADE INTO V_ESTOQUE FROM Item
    WHERE ID_item = :NEW.ID_item;

    IF V_ESTOQUE >= :NEW.QUANTIDADE THEN 
       UPDATE Item
       SET QUANTIDADE = QUANTIDADE - :NEW.QUANTIDADE
       WHERE ID_item = :NEW.ID_item;
    ELSE
        RAISE_APPLICATION_ERROR(-20001,'ITEM ESTA SEM ESTOQUE:');
        
    END IF;
END;